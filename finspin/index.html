<html>

<head>
    <link rel="stylesheet" href="./main.css" />
    <script type="text/javascript" src="./main.js">
    </script>

</head>

<body>

    <main></main>

    <div id="note"></div>

    <script type="text/javascript">
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    Array
                        .from(mutation.addedNodes)
                        .filter(function(node) {
                            return node.tagName === 'svg';
                        })
                        .forEach(function(node) {
                            node.addEventListener('click', function(event) {
                                var rect = event.currentTarget.getBoundingClientRect();
                                var svgClickEvent = new CustomEvent('svgclick', {
                                    detail: {
                                        x: event.clientX - rect.left,
                                        y: event.clientY - rect.top
                                    }
                                });
                                event.currentTarget.dispatchEvent(svgClickEvent);
                            });
                        });
                }
            });
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        const app = Elm.Main.init({
            node: document.getElementById('note')
        })

        app.ports.storeNotes.subscribe(function(notes) {
            var notesJson = JSON.stringify(notes);
            localStorage.setItem('note-app-save', notesJson);
            let fileStore = localStorage.getItem('note-app-save');
            app.ports.receiveData.send(fileStore);
        });
        //Init load
        let fileStore = localStorage.getItem('note-app-save');
        app.ports.receiveData.send(fileStore);
        // var app = Elm.Main.init({
        //     node: document.querySelector('main')
        // });
    </script>
    <a href="https://github.com/ranraj/finspin"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67"
            alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
</body>


</html>